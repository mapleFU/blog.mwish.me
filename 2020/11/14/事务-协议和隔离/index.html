<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="事务：隔离级别和协议应用程序员会依赖事务这么一种抽象：事务。它提供了 ACID 的抽象，A 可以理解为多行数据读&#x2F;写的原子性；C 据说是用来凑数的；I 表示事务中间有某种互相隔离；D 表示事务是持久的。对于应用程序员而言，抽象是隔离级别。关于这点，可以简单这么理解：隔离级别越高，冲突越剧烈，可能的性能会更差。而我们也可以牺牲一些保证，来提供性能 对应用程序员而言，需要理解的是隔离级别，甚至数据库更">
<meta property="og:type" content="article">
<meta property="og:title" content="事务:协议和隔离">
<meta property="og:url" content="http://blog.mwish.me/2020/11/14/%E4%BA%8B%E5%8A%A1-%E5%8D%8F%E8%AE%AE%E5%92%8C%E9%9A%94%E7%A6%BB/index.html">
<meta property="og:site_name" content="风空之岛">
<meta property="og:description" content="事务：隔离级别和协议应用程序员会依赖事务这么一种抽象：事务。它提供了 ACID 的抽象，A 可以理解为多行数据读&#x2F;写的原子性；C 据说是用来凑数的；I 表示事务中间有某种互相隔离；D 表示事务是持久的。对于应用程序员而言，抽象是隔离级别。关于这点，可以简单这么理解：隔离级别越高，冲突越剧烈，可能的性能会更差。而我们也可以牺牲一些保证，来提供性能 对应用程序员而言，需要理解的是隔离级别，甚至数据库更">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://image.mwish.me/blog-image/8A4D7051-23D4-43B1-9E29-90FC938CD97A.png">
<meta property="og:image" content="https://image.mwish.me/blog-image/6B34260B-EF80-4FA3-AC86-94F2B91FD159.png">
<meta property="og:image" content="https://image.mwish.me/blog-image/9702A3CB-D18C-4751-AF2E-4B346C879B2F.png">
<meta property="og:image" content="https://image.mwish.me/blog-image/53878744-E179-4603-B768-D80DBCFD58EF.png">
<meta property="og:image" content="https://image.mwish.me/blog-image/33241D20-8EB6-46C6-9AAD-EDAC95237199.png">
<meta property="og:image" content="https://image.mwish.me/blog-image/89DEB4D5-C31F-4430-9C08-B1E314CAF4A6.png">
<meta property="og:image" content="https://image.mwish.me/blog-image/813DDC98-A805-41A7-B406-9D4986272255.png">
<meta property="og:image" content="https://image.mwish.me/blog-image/DF4CBE7C-03E6-4F03-83A2-5DD32CB18F17.png">
<meta property="og:image" content="https://image.mwish.me/blog-image/8F504CF7-0381-4DBB-810E-65126DE2D4A8.png">
<meta property="og:image" content="https://image.mwish.me/blog-image/FC512948-7B2A-4A46-BFA8-BABC63264652.png">
<meta property="og:image" content="https://image.mwish.me/blog-image/60CD6506-2D23-46AC-AAC2-655921CADD0C.png">
<meta property="og:image" content="https://image.mwish.me/blog-image/5E61590D-1A6F-4C8D-9E8A-1E542DEE85E7.png">
<meta property="og:image" content="https://image.mwish.me/blog-image/02E27F7E-B745-41F5-81F0-52A2D284F9D1.png">
<meta property="article:published_time" content="2020-11-14T06:45:32.000Z">
<meta property="article:modified_time" content="2022-07-19T12:23:50.563Z">
<meta property="article:author" content="mwish">
<meta property="article:tag" content="database">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://image.mwish.me/blog-image/8A4D7051-23D4-43B1-9E29-90FC938CD97A.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/logo.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/logo.ico" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/logo.ico">
        
      
    
    <!-- title -->
    <title>事务:协议和隔离</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.2.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="目录"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="目录"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="顶部" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇" href="/2020/11/15/transaction-concurrency-control/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇" href="/2020/11/08/%E8%BD%AF-%E7%A1%AC%E7%9A%84%E5%88%86%E7%95%8C-%E8%99%9A%E6%8B%9F/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://blog.mwish.me/2020/11/14/%E4%BA%8B%E5%8A%A1-%E5%8D%8F%E8%AE%AE%E5%92%8C%E9%9A%94%E7%A6%BB/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://blog.mwish.me/2020/11/14/%E4%BA%8B%E5%8A%A1-%E5%8D%8F%E8%AE%AE%E5%92%8C%E9%9A%94%E7%A6%BB/&text=事务:协议和隔离"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://blog.mwish.me/2020/11/14/%E4%BA%8B%E5%8A%A1-%E5%8D%8F%E8%AE%AE%E5%92%8C%E9%9A%94%E7%A6%BB/&title=事务:协议和隔离"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://blog.mwish.me/2020/11/14/%E4%BA%8B%E5%8A%A1-%E5%8D%8F%E8%AE%AE%E5%92%8C%E9%9A%94%E7%A6%BB/&is_video=false&description=事务:协议和隔离"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=事务:协议和隔离&body=Check out this article: http://blog.mwish.me/2020/11/14/%E4%BA%8B%E5%8A%A1-%E5%8D%8F%E8%AE%AE%E5%92%8C%E9%9A%94%E7%A6%BB/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://blog.mwish.me/2020/11/14/%E4%BA%8B%E5%8A%A1-%E5%8D%8F%E8%AE%AE%E5%92%8C%E9%9A%94%E7%A6%BB/&title=事务:协议和隔离"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://blog.mwish.me/2020/11/14/%E4%BA%8B%E5%8A%A1-%E5%8D%8F%E8%AE%AE%E5%92%8C%E9%9A%94%E7%A6%BB/&title=事务:协议和隔离"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://blog.mwish.me/2020/11/14/%E4%BA%8B%E5%8A%A1-%E5%8D%8F%E8%AE%AE%E5%92%8C%E9%9A%94%E7%A6%BB/&title=事务:协议和隔离"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://blog.mwish.me/2020/11/14/%E4%BA%8B%E5%8A%A1-%E5%8D%8F%E8%AE%AE%E5%92%8C%E9%9A%94%E7%A6%BB/&title=事务:协议和隔离"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://blog.mwish.me/2020/11/14/%E4%BA%8B%E5%8A%A1-%E5%8D%8F%E8%AE%AE%E5%92%8C%E9%9A%94%E7%A6%BB/&name=事务:协议和隔离&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://blog.mwish.me/2020/11/14/%E4%BA%8B%E5%8A%A1-%E5%8D%8F%E8%AE%AE%E5%92%8C%E9%9A%94%E7%A6%BB/&t=事务:协议和隔离"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%EF%BC%9A%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E5%92%8C%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.</span> <span class="toc-text">事务：隔离级别和协议</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ANSI-92-Phenomena"><span class="toc-number">1.1.</span> <span class="toc-text">ANSI-92 Phenomena</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E6%A8%A1-History-Event-Order"><span class="toc-number">1.1.1.</span> <span class="toc-text">建模: History Event Order</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Event"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">Event</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Version"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">Version</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Predicate"><span class="toc-number">1.1.2.</span> <span class="toc-text">Predicate</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Dependencies"><span class="toc-number">1.2.</span> <span class="toc-text">Dependencies</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Read-Dependencies"><span class="toc-number">1.2.1.</span> <span class="toc-text">Read Dependencies</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#predicate-based-conflict"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">predicate-based conflict</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Directly-Read-Dependency"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">Directly Read Dependency</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Anti-Dependency"><span class="toc-number">1.2.2.</span> <span class="toc-text">Anti Dependency</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#predicate-based-conflict-1"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">predicate-based conflict</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Directly-Anti-Dependency"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">Directly Anti Dependency</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Write-Dependency"><span class="toc-number">1.2.3.</span> <span class="toc-text">Write Dependency</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Serialization-Graph"><span class="toc-number">1.3.</span> <span class="toc-text">Serialization Graph</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#New-Generalized-Isolation-Specifications"><span class="toc-number">1.4.</span> <span class="toc-text">New Generalized Isolation Specifications</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PL-1"><span class="toc-number">1.4.1.</span> <span class="toc-text">PL-1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PL-2"><span class="toc-number">1.4.2.</span> <span class="toc-text">PL-2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PL-3"><span class="toc-number">1.4.3.</span> <span class="toc-text">PL-3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PL-2-99"><span class="toc-number">1.4.4.</span> <span class="toc-text">PL-2.99</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Snapshot-Isolation-PL-SI"><span class="toc-number">1.4.5.</span> <span class="toc-text">Snapshot Isolation: PL-SI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PL-2-1"><span class="toc-number">1.4.6.</span> <span class="toc-text">PL-2+</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PL-2L"><span class="toc-number">1.4.7.</span> <span class="toc-text">PL-2L</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PL-SI"><span class="toc-number">1.4.8.</span> <span class="toc-text">PL-SI</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%B0%E5%AE%9E%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.5.</span> <span class="toc-text">现实中的数据库</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        事务:协议和隔离
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">mwish</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-11-14T06:45:32.000Z" itemprop="datePublished">2020-11-14</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/database/" rel="tag">database</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="事务：隔离级别和协议"><a href="#事务：隔离级别和协议" class="headerlink" title="事务：隔离级别和协议"></a>事务：隔离级别和协议</h1><p>应用程序员会依赖事务这么一种抽象：事务。它提供了 ACID 的抽象，A 可以理解为多行数据读/写的原子性；C 据说是用来凑数的；I 表示事务中间有某种互相隔离；D 表示事务是持久的。对于应用程序员而言，抽象是隔离级别。关于这点，可以简单这么理解：<strong>隔离级别越高，冲突越剧烈，可能的性能会更差</strong>。而我们也可以牺牲一些保证，来提供性能</p>
<p>对应用程序员而言，需要理解的是隔离级别，甚至数据库更上层的建模、缓存。ANSI-92 中给出了一定的隔离级别的定义，但是对乐观的事务而言，我们仍然需要理解一些不同的标准。我们下面会介绍一些隔离级别，这里援引了 DDIA 的定义：</p>
<ol>
<li>Read Committed: <ol>
<li>（最基础的隔离级别，很多时候</li>
<li>从 DB 读的时候，只能看到已经提交的数据，没有脏读</li>
<li>写入的时候，不会覆盖掉未写入的数据，没有脏写</li>
<li>可能的实现：行级别的 Lock，或者是 MVCC/COW 等机制</li>
</ol>
</li>
<li>Repeatable Read: 没有 read skew</li>
<li>Snapshot Isolation: 从一个一致性的视图中读取<ol>
<li>没有read skew</li>
<li>可能会有 write skew</li>
</ol>
</li>
<li>Serializable: 所有事务的调度是可串行化的</li>
</ol>
<p>我们还有一些现象，代表某种程度上对事务的 break：</p>
<ol>
<li>Dirty reads: 看到了未提交的数据</li>
<li>Dirty write: 不能覆盖另一个事务的尚未提交的一部分</li>
<li>Read skew/unrepeatable read: 两次读同一个 record 可能读到不同的值</li>
<li>write skew: 可以将写入偏差视为丢失更新问题的一般化。如果两个事务读取相同的对象，然后更新其中 一些对象（不同的事务可能更新不同的对象），则可能发生写入偏差。在多个事务更新同一<br>个对象的特殊情况下，就会发生脏写或丢失更新（取决于时机）。在 PG MySQL/InnoDB 等的 RR 级别下，都无法避免 Write Skew</li>
<li>phantom read：DDIA 认为这是导致写入偏差的根源，SELECT 查询到符合条件的 columns，然后按照条件操作一个 subset。这个时候，一个事务中的写入导致了另一个事务查询结果被改变。 </li>
</ol>
<p>其实上面这些我整理的还是挺乱的，有空的可以回顾一下 DDIA…但是上面这些虽然乱，但是对应的内容其实是不难懂的。难就难在显示可能有点区别：</p>
<ul>
<li>DDIA 的定义倾向于 2PL + MVCC 相关，但是实际上会有不同的实现。别看实现都会尽量实现标准，但是在数据库领域，某个地方的实现能决定太多的行为了。</li>
<li>有很多数据库采取乐观的并发控制，他们的表现会不会不太一样？</li>
<li>有部分数据库实现上采取 SI 代替 RR，这会不会导致定义上有什么问题？</li>
<li>如何理解 MySQL，PG 这类的隔离级别？</li>
<li>“写后读” 这些定义和上述有什么关系？</li>
</ul>
<p>我们尽量以不介绍实现的情况下来讲讲，但是下面内容可能不可避免的要求你对 2PL MVCC SI 有着最基础的理解。在数据库领域，某个地方的实现能决定整个链路的行为。</p>
<h2 id="ANSI-92-Phenomena"><a href="#ANSI-92-Phenomena" class="headerlink" title="ANSI-92 Phenomena"></a>ANSI-92 Phenomena</h2><p><img src="https://image.mwish.me/blog-image/8A4D7051-23D4-43B1-9E29-90FC938CD97A.png" alt="8A4D7051-23D4-43B1-9E29-90FC938CD97A"></p>
<p><img src="https://image.mwish.me/blog-image/6B34260B-EF80-4FA3-AC86-94F2B91FD159.png" alt="6B34260B-EF80-4FA3-AC86-94F2B91FD159"></p>
<p>1/2 表示事务 ID，c a 表示 COMMIT ABORT，那么我们可以很好的把上面的四个 P 对应到 DDIA 的定义中。这个需要放到单对象 + Lock 的环境下理解：</p>
<ol>
<li>P0: 对单对象的覆盖写入，即脏写，导致仅 COMMIT 的时候数据库的状态为 Txn2 的写入。</li>
<li>P1 对单对象的脏读。如果 TXN1 abort 了，那么显然很危险。</li>
<li>P2: 写修改了读, 类似不可重复读的修改。</li>
<li>P3: Phantom Read，对于某个 Predicate 的读 — 改</li>
</ol>
<p>懂了这些，你应该很好看懂上面的定义。</p>
<p>但是你可以发现，其实某些时候，在乐观并发或者 MVCC 下，有些调度甚至是没问题的。SI 甚至让事情更模糊。这里我们可以参考另一篇论文，《Generalize Isolation Level Definitions》的定义了。</p>
<p>懂了这些，你应该很好看懂上面我们在第一节的定义。但是这个定义是又麻烦的：对于乐观甚至 MVCC 的实现，我没可能不会显示锁定/允许读写是并存的，那么这个定义实际上就是不能满足的。实际上我们可以 break P0/P1：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">H1: r1(x, 5) w1(x, 1) r1(y, 5) w1(y, 9) r2(x, 1) r2(y, 9) c1 c2</span><br></pre></td></tr></table></figure>
<p>那么，这里 break 了上面的要求，但是仍然是可串行化的调度。所以我们需要一个更 specific 的模型来描述。</p>
<h3 id="建模-History-Event-Order"><a href="#建模-History-Event-Order" class="headerlink" title="建模: History Event Order"></a>建模: History Event Order</h3><p>我们需要确切描述事务，我们就需要一个具体的模型。我们先远离关系的概念，从 row/tuple 开始：</p>
<ul>
<li><p>row/tuple 是一个 object，对于单个 Object 而言，事务以一个 total order 操作这个 object</p>
</li>
<li><p>一个 object 有 1 个以上的版本，可以读到 committed, uncommitted 甚至 abort 的数据</p>
</li>
<li><p>如果 $T_i$ commit 了，那么认为对 $T_i$ 而言，它写入的任何一个 Object 的版本 $x_i$ , $T_i$ install $x_i$, 如果 $T_i$ abort 了，那么 $x_i$ 不会被视作 committed 的一部分。</p>
</li>
<li><p>$T<em>{init}$ 是一个抽象的事务，它被视作最初的事务，给每个出现的 object 一个虚拟的初始版本 $X</em>{init}$ ，当事务第一次写入的时候，从 init 变成最初状态。当这个 object 被删除的时候，被标记成最终版本 $X_{dead}$ 。</p>
</li>
<li><p>如果一个对象被删除后又被插入了，那么视为两个不同的对象。</p>
</li>
</ul>
<p>我们把整个操作的序列称为 <strong>Transaction History</strong>，History 有两部分组成：</p>
<ul>
<li>偏序的 <strong>Events</strong> (<strong>E</strong>)</li>
<li>全序的 version order</li>
</ul>
<h4 id="Event"><a href="#Event" class="headerlink" title="Event"></a>Event</h4><p>对于 Event，我们可以有：</p>
<ol>
<li>Read(r)</li>
<li>Write(w)</li>
<li>commit(c)</li>
<li>abort(a)</li>
</ol>
<p>我们有如下的记号</p>
<ol>
<li>TXN j 读 X 读到版本 i, 获得值 v，可以记作 $r<em>j(x_i, v)$ 或者 $r_j(x</em>{i.v})$</li>
<li>TXN i 写 X 写入到版本 i, 值 v，可以记作 $w<em>i(x_i, v)$ 或者 $w_i(x</em>{i.v})$</li>
</ol>
<p>对于这个 order，我们要明白 Event 和 version order 的规则：</p>
<p>对于 Event 而言，它保证了事务的偏序关系：</p>
<ol>
<li>如果  $r<em>j(x_i, v)$ 存在，那么它 preceded by $w_i(x</em>{i.v})$, 并且对应着“最近的写入”</li>
<li>在 Event 中，如果 $w<em>i(x</em>{i.v})$ 和  $r<em>j(x.m)$ 中没有任何一个 $w_i(x</em>{i.{v2}})$, 那么  $r<em>j(x.m)$ 独到的必定等于 $x</em>{i.v}$</li>
<li>History 必须是完整的，有事务就必须有对应的 commit/abort</li>
</ol>
<h4 id="Version"><a href="#Version" class="headerlink" title="Version"></a>Version</h4><p>对于 version 而言：</p>
<ol>
<li>对象 x 有一个 init 版本和至多一个 dead 版本</li>
<li>它的可见版本在 init 版本和 dead 版本之间</li>
<li>如果 History 有 $r_j(x_i)$ 那么 $x_i$ 为可见版本，无论是否 commit</li>
</ol>
<p>同时，需要注意的是，version order 不一定和写入顺序是完全一样的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">w1(x1) w2(x2) w2(y2) c1 c2</span><br><span class="line">r3(x1) w3(x3) w4(y4) a4</span><br></pre></td></tr></table></figure>
<p>这里 x2 在 x1 后写入，但是因为 commit 的 order，实际上对应的 x1 在 x2 前。</p>
<h3 id="Predicate"><a href="#Predicate" class="headerlink" title="Predicate"></a>Predicate</h3><p>对于谓词而言，我们需要引入额外的记号。P 是一个 Boolean expression，在数据集里面，满足这个要求的版本集合被称为 <code>Vset(P)</code> 。注意，这个集合 之包含存在的记录，未涉及的 init 记录这些是不存在的, 它只包含对应的 visible 对象。</p>
<p>对于读取而言，假设有下列的 SQL：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> EMPLOYEE <span class="keyword">WHERE</span> DEPT <span class="operator">=</span> SALES;</span><br></pre></td></tr></table></figure>
<p>同时有 x,  y 两个 object ，它们的版本分别为 1 2，x 满足 <code>DEPT=SALES</code>满足需求的 z0 在未来会被插入。</p>
<p>那么我们需要写出对应的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rj(P: Vset(P)) rj(xj) rj(yj) ...</span><br></pre></td></tr></table></figure>
<p>对，这下复杂了很多：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ri(dept=sales: x1; y2) rj(xj)</span><br></pre></td></tr></table></figure>
<h2 id="Dependencies"><a href="#Dependencies" class="headerlink" title="Dependencies"></a>Dependencies</h2><p>这篇论文定义了三种 conflict，同时分为了 regular conflict 和 predicate-based conflict。它们描述的是事务之间的依赖关系。</p>
<h3 id="Read-Dependencies"><a href="#Read-Dependencies" class="headerlink" title="Read Dependencies"></a>Read Dependencies</h3><h4 id="predicate-based-conflict"><a href="#predicate-based-conflict" class="headerlink" title="predicate-based conflict"></a>predicate-based conflict</h4><p>对于一个 Predicate，如果某个事务在它读之前，插入了满足 Predicate 的记录，那么会有 read dependency</p>
<h4 id="Directly-Read-Dependency"><a href="#Directly-Read-Dependency" class="headerlink" title="Directly Read Dependency"></a>Directly Read Dependency</h4><p>事务 $T_j$  direct read depend $T_i$ 时，会有下列的条件：</p>
<ul>
<li>directly item-read-depents: Tj 读到了 Ti 写入的记录</li>
<li>directly predicate-read-depends: Ti 更新了满足匹配 <code>Vset(P)</code> 的对象，并且被 Tj 读到了</li>
</ul>
<h3 id="Anti-Dependency"><a href="#Anti-Dependency" class="headerlink" title="Anti Dependency"></a>Anti Dependency</h3><p>当事务覆盖了另一个事务独到的值的时候，产生了 anti-dependency。</p>
<h4 id="predicate-based-conflict-1"><a href="#predicate-based-conflict-1" class="headerlink" title="predicate-based conflict"></a>predicate-based conflict</h4><p>对于一个 Predicate，如果某个事务在它读之后，插入了满足 Predicate 的记录，那么会有 anti dependency</p>
<h4 id="Directly-Anti-Dependency"><a href="#Directly-Anti-Dependency" class="headerlink" title="Directly Anti Dependency"></a>Directly Anti Dependency</h4><p>事务 $T_j$  direct anti depend $T_i$ 时，会有下列的条件：</p>
<ul>
<li>directly item-anti-depents: Ti 覆盖了 Tj 读到的记录</li>
<li>directly predicate-anti-depends: Ti 更新了满足匹配 <code>Vset(P)</code> 的对象，他之前并且被 Tj 读到了</li>
</ul>
<h3 id="Write-Dependency"><a href="#Write-Dependency" class="headerlink" title="Write Dependency"></a>Write Dependency</h3><p>如果事务 $T_i$ 覆盖了 $T_j$ 写入的版本，那么它们有 direct-write-depend。</p>
<h2 id="Serialization-Graph"><a href="#Serialization-Graph" class="headerlink" title="Serialization Graph"></a>Serialization Graph</h2><p><img src="https://image.mwish.me/blog-image/9702A3CB-D18C-4751-AF2E-4B346C879B2F.png" alt="9702A3CB-D18C-4751-AF2E-4B346C879B2F"></p>
<p>有一点关键是，事务或许不是全序的，但是至少应该是<strong>偏序</strong>的。所以，我们对事务构建 DAG，不应该存在环。</p>
<p>那么，通过上述几种 dependency，我们可以构建依赖的有向图，来判断具体的关系。</p>
<p><img src="https://image.mwish.me/blog-image/53878744-E179-4603-B768-D80DBCFD58EF.png" alt="53878744-E179-4603-B768-D80DBCFD58EF"></p>
<p>同时可以定义 depends 关系：</p>
<p><img src="https://image.mwish.me/blog-image/33241D20-8EB6-46C6-9AAD-EDAC95237199.png" alt="33241D20-8EB6-46C6-9AAD-EDAC95237199"></p>
<h2 id="New-Generalized-Isolation-Specifications"><a href="#New-Generalized-Isolation-Specifications" class="headerlink" title="New Generalized Isolation Specifications"></a>New Generalized Isolation Specifications</h2><blockquote>
<p>Like the previous approaches, we will define each iso- lation level in terms of phenomena that must be avoided at each level. Our phenomena are prefixed by “G” to denote the fact that they are general enough to allow locking and op- timistic implementations; these phenomena are named G0, G1, and so on (by analogy with P0, P1, etc of [6]). We will refer to the new levels as PL levels (where PL stands for “portable level”) to avoid the possible confusion with the degrees of isolation given in [8, 13].</p>
</blockquote>
<p>这里用 G 表示 phenomena，PL 表示 portable levels。</p>
<h3 id="PL-1"><a href="#PL-1" class="headerlink" title="PL-1"></a>PL-1</h3><p>这个对应的其实相当于 P0，我们抄英文看看原定义：</p>
<blockquote>
<p>we define <strong>PL-1</strong> as the level in which G0 is disallowed:</p>
<p><strong>G0: Write Cycles.</strong> A history H exhibits phenomenon G0 if DSG(H) contains a directed cycle consisting entirely of write-dependency edges.</p>
</blockquote>
<p><img src="https://image.mwish.me/blog-image/89DEB4D5-C31F-4430-9C08-B1E314CAF4A6.png" alt="89DEB4D5-C31F-4430-9C08-B1E314CAF4A6"></p>
<p>实际上覆盖写未提交的本身在 2PL 意外的实现中不一定出了大问题，但是如果有上述的重复覆盖，那么就会真正出现问题。即如上图。同时论文也给出了 predicate 相关的 $H_{wcycle}$</p>
<p><img src="https://image.mwish.me/blog-image/813DDC98-A805-41A7-B406-9D4986272255.png" alt="813DDC98-A805-41A7-B406-9D4986272255"></p>
<h3 id="PL-2"><a href="#PL-2" class="headerlink" title="PL-2"></a>PL-2</h3><p>PL-1 对读是没有限制的，当然，出现我们之前说的“脏读”就太正常了。</p>
<p>G1 由 G1a G1b G1c 构成：</p>
<p><img src="https://image.mwish.me/blog-image/DF4CBE7C-03E6-4F03-83A2-5DD32CB18F17.png" alt="DF4CBE7C-03E6-4F03-83A2-5DD32CB18F17"></p>
<p>G1a: 读到了 abort 事务的数据。</p>
<p><img src="https://image.mwish.me/blog-image/8F504CF7-0381-4DBB-810E-65126DE2D4A8.png" alt="8F504CF7-0381-4DBB-810E-65126DE2D4A8"></p>
<p>G1b: 读到了事务<strong>中间</strong> 的数据</p>
<p><img src="https://image.mwish.me/blog-image/FC512948-7B2A-4A46-BFA8-BABC63264652.png" alt="FC512948-7B2A-4A46-BFA8-BABC63264652"></p>
<p>G1c: 产生了 direct 的环。即 direct rr, rw, wr 的环。</p>
<blockquote>
<p>Phenomenon G1 captures the essence of no-dirty-reads and is comprised of G1a, G1b and G1c. We define isolation level <strong>PL-2</strong> as one in which phenomenon G1 is disallowed. Proscribing G1 is clearly weaker than proscribing P1 since G1 allows reads from uncommitted transactions. </p>
</blockquote>
<p>实际上，这个相当于 read committed, 但是会弱一些：</p>
<blockquote>
<p>Proscribing G1 is clearly weaker than proscribing P1 since G1 allows reads from uncommitted transactions.</p>
</blockquote>
<p>P1 不允许<strong>脏读</strong>，那么 PL-2 靠：</p>
<ol>
<li>不允许读到 abort/中间的数据，但是允许短暂读到 uncommitted 的数据</li>
</ol>
<p>实际上，这相当于，<strong>被 committed 的事务</strong> 可以读到 <strong>未提交但未来被提交</strong> 的数据。</p>
<p>direct 依赖的环比较难理解，就是 Figure2 那些。这个我简单推导一下为什么这个能满足 对应的 read committed：</p>
<ul>
<li>$T_i$ 事务读一组 x, y, z… 读到 $x_k$ $y_k$ …</li>
<li>$T_i$ 在一组子集上再次读，读到了 $T_j$ 写入的数据，这个时候，$T_i$ depend $T_j$</li>
<li>$T_j$ 如果有任何情况下直接依赖了 $T_i$ 的数据，那么这个顺序就被 break</li>
</ul>
<p>但是这个没有禁止 anti-dependency, 即 P2 P3 对应的</p>
<ul>
<li>$T_j$ $T_k$ 事务读一组 x, y, z… 读到 $x_k$ $y_k$ …</li>
<li>$T_j$ 修改了 $x_k$ ，改为 $x_j$ , commit, 这个时候 $T_k$ anti depend $T_j$</li>
<li>$T_k$ 读到了 $x_k$ , 这个时候 $T_j$ depent $T_k$</li>
</ul>
<p>好了，break 了！</p>
<h3 id="PL-3"><a href="#PL-3" class="headerlink" title="PL-3"></a>PL-3</h3><p><img src="https://image.mwish.me/blog-image/60CD6506-2D23-46AC-AAC2-655921CADD0C.png" alt="60CD6506-2D23-46AC-AAC2-655921CADD0C"></p>
<p>禁止所有 anti-dependency 之后，整个事务就变的<strong>有序了</strong>。这对应 serializable。其实这个相对来说是最好理解的。</p>
<h3 id="PL-2-99"><a href="#PL-2-99" class="headerlink" title="PL-2.99"></a>PL-2.99</h3><p>这个对应的是 repeatable read. </p>
<p><img src="https://image.mwish.me/blog-image/5E61590D-1A6F-4C8D-9E8A-1E542DEE85E7.png" alt="5E61590D-1A6F-4C8D-9E8A-1E542DEE85E7"></p>
<p>它允许 Item Anti-dependency, 用来处理可重复读。</p>
<h3 id="Snapshot-Isolation-PL-SI"><a href="#Snapshot-Isolation-PL-SI" class="headerlink" title="Snapshot Isolation: PL-SI"></a>Snapshot Isolation: PL-SI</h3><p>我一下没找到这个定义，有点蒙圈，后来发现在博士论文 4.3 里…</p>
<p>好吧，坑啊！这里定义了 PL-2+ 来引入 PL-SI：</p>
<h3 id="PL-2-1"><a href="#PL-2-1" class="headerlink" title="PL-2+"></a>PL-2+</h3><p>PL-2+ 表示看到一致性视图的最低级别</p>
<blockquote>
<p><strong>G-single: Single Anti-dependency Cycles.</strong> A history H exhibits phenomenon G- single if DSG(H) contains a directed cycle with exactly one anti-dependency edge.</p>
<p>Level <strong>PL-2+</strong> proscribes G1 and G-single. Intuitively, PL-2+ provides consistency because cycles with one anti-dependency edge occur exactly when some transaction both observes and misses modifications of another transaction.</p>
</blockquote>
<h3 id="PL-2L"><a href="#PL-2L" class="headerlink" title="PL-2L"></a>PL-2L</h3><p>这个级别表示了单调读。</p>
<h3 id="PL-SI"><a href="#PL-SI" class="headerlink" title="PL-SI"></a>PL-SI</h3><p><img src="https://image.mwish.me/blog-image/02E27F7E-B745-41F5-81F0-52A2D284F9D1.png" alt="02E27F7E-B745-41F5-81F0-52A2D284F9D1"></p>
<p>具体定义还是蛮复杂的，简单来说是：</p>
<ol>
<li>涉及一个 start 的时间戳的序，在 start 开始之后的 read-write dependency 不能存在（但是可以存在 anti-dependency, 如下文所述）</li>
<li>写入不发生冲突</li>
<li>允许 PL-2+ 定义的 consistent view, 可以有且仅有单个 anti-dependency 边的 cycle 存在。（</li>
</ol>
<h2 id="现实中的数据库"><a href="#现实中的数据库" class="headerlink" title="现实中的数据库"></a>现实中的数据库</h2><p><a target="_blank" rel="noopener" href="https://github.com/ept/hermitage">https://github.com/ept/hermitage</a></p>
<p>上面这个链接是现实数据库中对应的隔离级别。</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%EF%BC%9A%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E5%92%8C%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.</span> <span class="toc-text">事务：隔离级别和协议</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ANSI-92-Phenomena"><span class="toc-number">1.1.</span> <span class="toc-text">ANSI-92 Phenomena</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E6%A8%A1-History-Event-Order"><span class="toc-number">1.1.1.</span> <span class="toc-text">建模: History Event Order</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Event"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">Event</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Version"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">Version</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Predicate"><span class="toc-number">1.1.2.</span> <span class="toc-text">Predicate</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Dependencies"><span class="toc-number">1.2.</span> <span class="toc-text">Dependencies</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Read-Dependencies"><span class="toc-number">1.2.1.</span> <span class="toc-text">Read Dependencies</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#predicate-based-conflict"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">predicate-based conflict</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Directly-Read-Dependency"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">Directly Read Dependency</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Anti-Dependency"><span class="toc-number">1.2.2.</span> <span class="toc-text">Anti Dependency</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#predicate-based-conflict-1"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">predicate-based conflict</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Directly-Anti-Dependency"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">Directly Anti Dependency</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Write-Dependency"><span class="toc-number">1.2.3.</span> <span class="toc-text">Write Dependency</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Serialization-Graph"><span class="toc-number">1.3.</span> <span class="toc-text">Serialization Graph</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#New-Generalized-Isolation-Specifications"><span class="toc-number">1.4.</span> <span class="toc-text">New Generalized Isolation Specifications</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PL-1"><span class="toc-number">1.4.1.</span> <span class="toc-text">PL-1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PL-2"><span class="toc-number">1.4.2.</span> <span class="toc-text">PL-2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PL-3"><span class="toc-number">1.4.3.</span> <span class="toc-text">PL-3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PL-2-99"><span class="toc-number">1.4.4.</span> <span class="toc-text">PL-2.99</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Snapshot-Isolation-PL-SI"><span class="toc-number">1.4.5.</span> <span class="toc-text">Snapshot Isolation: PL-SI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PL-2-1"><span class="toc-number">1.4.6.</span> <span class="toc-text">PL-2+</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PL-2L"><span class="toc-number">1.4.7.</span> <span class="toc-text">PL-2L</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PL-SI"><span class="toc-number">1.4.8.</span> <span class="toc-text">PL-SI</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%B0%E5%AE%9E%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.5.</span> <span class="toc-text">现实中的数据库</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://blog.mwish.me/2020/11/14/%E4%BA%8B%E5%8A%A1-%E5%8D%8F%E8%AE%AE%E5%92%8C%E9%9A%94%E7%A6%BB/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://blog.mwish.me/2020/11/14/%E4%BA%8B%E5%8A%A1-%E5%8D%8F%E8%AE%AE%E5%92%8C%E9%9A%94%E7%A6%BB/&text=事务:协议和隔离"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://blog.mwish.me/2020/11/14/%E4%BA%8B%E5%8A%A1-%E5%8D%8F%E8%AE%AE%E5%92%8C%E9%9A%94%E7%A6%BB/&title=事务:协议和隔离"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://blog.mwish.me/2020/11/14/%E4%BA%8B%E5%8A%A1-%E5%8D%8F%E8%AE%AE%E5%92%8C%E9%9A%94%E7%A6%BB/&is_video=false&description=事务:协议和隔离"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=事务:协议和隔离&body=Check out this article: http://blog.mwish.me/2020/11/14/%E4%BA%8B%E5%8A%A1-%E5%8D%8F%E8%AE%AE%E5%92%8C%E9%9A%94%E7%A6%BB/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://blog.mwish.me/2020/11/14/%E4%BA%8B%E5%8A%A1-%E5%8D%8F%E8%AE%AE%E5%92%8C%E9%9A%94%E7%A6%BB/&title=事务:协议和隔离"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://blog.mwish.me/2020/11/14/%E4%BA%8B%E5%8A%A1-%E5%8D%8F%E8%AE%AE%E5%92%8C%E9%9A%94%E7%A6%BB/&title=事务:协议和隔离"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://blog.mwish.me/2020/11/14/%E4%BA%8B%E5%8A%A1-%E5%8D%8F%E8%AE%AE%E5%92%8C%E9%9A%94%E7%A6%BB/&title=事务:协议和隔离"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://blog.mwish.me/2020/11/14/%E4%BA%8B%E5%8A%A1-%E5%8D%8F%E8%AE%AE%E5%92%8C%E9%9A%94%E7%A6%BB/&title=事务:协议和隔离"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://blog.mwish.me/2020/11/14/%E4%BA%8B%E5%8A%A1-%E5%8D%8F%E8%AE%AE%E5%92%8C%E9%9A%94%E7%A6%BB/&name=事务:协议和隔离&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://blog.mwish.me/2020/11/14/%E4%BA%8B%E5%8A%A1-%E5%8D%8F%E8%AE%AE%E5%92%8C%E9%9A%94%E7%A6%BB/&t=事务:协议和隔离"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2022-2024
    mwish
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板！\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功！");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FL51GBW6JT"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-FL51GBW6JT');
    </script>

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
